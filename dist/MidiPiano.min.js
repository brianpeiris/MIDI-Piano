function Stream(e){function t(t){var n=e.substr(s,t);return s+=t,n}function n(){var t=(e.charCodeAt(s)<<24)+(e.charCodeAt(s+1)<<16)+(e.charCodeAt(s+2)<<8)+e.charCodeAt(s+3);return s+=4,t}function r(){var t=(e.charCodeAt(s)<<8)+e.charCodeAt(s+1);return s+=2,t}function o(t){var n=e.charCodeAt(s);return t&&n>127&&(n-=256),s+=1,n}function a(){return s>=e.length}function i(){for(var e=0;;){var t=o();if(!(128&t))return e+t;e+=127&t,e<<=7}}var s=0;return{eof:a,read:t,readInt32:n,readInt16:r,readInt8:o,readVarInt:i}}function MidiFile(e){function t(e){var t=e.read(4),n=e.readInt32();return{id:t,length:n,data:e.read(n)}}function n(e){var t={};t.deltaTime=e.readVarInt();var n=e.readInt8();if(240==(240&n)){if(255==n){t.type="meta";var o=e.readInt8(),a=e.readVarInt();switch(o){case 0:if(t.subtype="sequenceNumber",2!=a)throw"Expected length for sequenceNumber event is 2, got "+a;return t.number=e.readInt16(),t;case 1:return t.subtype="text",t.text=e.read(a),t;case 2:return t.subtype="copyrightNotice",t.text=e.read(a),t;case 3:return t.subtype="trackName",t.text=e.read(a),t;case 4:return t.subtype="instrumentName",t.text=e.read(a),t;case 5:return t.subtype="lyrics",t.text=e.read(a),t;case 6:return t.subtype="marker",t.text=e.read(a),t;case 7:return t.subtype="cuePoint",t.text=e.read(a),t;case 32:if(t.subtype="midiChannelPrefix",1!=a)throw"Expected length for midiChannelPrefix event is 1, got "+a;return t.channel=e.readInt8(),t;case 47:if(t.subtype="endOfTrack",0!=a)throw"Expected length for endOfTrack event is 0, got "+a;return t;case 81:if(t.subtype="setTempo",3!=a)throw"Expected length for setTempo event is 3, got "+a;return t.microsecondsPerBeat=(e.readInt8()<<16)+(e.readInt8()<<8)+e.readInt8(),t;case 84:if(t.subtype="smpteOffset",5!=a)throw"Expected length for smpteOffset event is 5, got "+a;var i=e.readInt8();return t.frameRate={0:24,32:25,64:29,96:30}[96&i],t.hour=31&i,t.min=e.readInt8(),t.sec=e.readInt8(),t.frame=e.readInt8(),t.subframe=e.readInt8(),t;case 88:if(t.subtype="timeSignature",4!=a)throw"Expected length for timeSignature event is 4, got "+a;return t.numerator=e.readInt8(),t.denominator=Math.pow(2,e.readInt8()),t.metronome=e.readInt8(),t.thirtyseconds=e.readInt8(),t;case 89:if(t.subtype="keySignature",2!=a)throw"Expected length for keySignature event is 2, got "+a;return t.key=e.readInt8(!0),t.scale=e.readInt8(),t;case 127:return t.subtype="sequencerSpecific",t.data=e.read(a),t;default:return t.subtype="unknown",t.data=e.read(a),t}return t.data=e.read(a),t}if(240==n){t.type="sysEx";var a=e.readVarInt();return t.data=e.read(a),t}if(247==n){t.type="dividedSysEx";var a=e.readVarInt();return t.data=e.read(a),t}throw"Unrecognised MIDI event type byte: "+n}var s;0==(128&n)?(s=n,n=r):(s=e.readInt8(),r=n);var u=n>>4;switch(t.channel=15&n,t.type="channel",u){case 8:return t.subtype="noteOff",t.noteNumber=s,t.velocity=e.readInt8(),t;case 9:return t.noteNumber=s,t.velocity=e.readInt8(),0==t.velocity?t.subtype="noteOff":t.subtype="noteOn",t;case 10:return t.subtype="noteAftertouch",t.noteNumber=s,t.amount=e.readInt8(),t;case 11:return t.subtype="controller",t.controllerType=s,t.value=e.readInt8(),t;case 12:return t.subtype="programChange",t.programNumber=s,t;case 13:return t.subtype="channelAftertouch",t.amount=s,t;case 14:return t.subtype="pitchBend",t.value=s+(e.readInt8()<<7),t;default:throw"Unrecognised MIDI event type: "+u}}var r;stream=Stream(e);var o=t(stream);if("MThd"!=o.id||6!=o.length)throw"Bad .mid file - header not found";var a=Stream(o.data),i=a.readInt16(),s=a.readInt16(),u=a.readInt16();if(32768&u)throw"Expressing time division in SMTPE frames is not supported yet";ticksPerBeat=u;for(var c={formatType:i,trackCount:s,ticksPerBeat:ticksPerBeat},l=[],d=0;d<c.trackCount;d++){l[d]=[];var f=t(stream);if("MTrk"!=f.id)throw"Unexpected chunk - expected MTrk, got "+f.id;for(var p=Stream(f.data);!p.eof();){var h=n(p);l[d].push(h)}}return{header:c,tracks:l}}function Replayer(e,t,n,r){function o(){for(var t=null,n=null,r=null,o=0;o<i.length;o++)null!=i[o].ticksToNextEvent&&(null==t||i[o].ticksToNextEvent<t)&&(t=i[o].ticksToNextEvent,n=o,r=i[o].nextEventIndex);if(null!=n){var a=e.tracks[n][r];e.tracks[n][r+1]?i[n].ticksToNextEvent+=e.tracks[n][r+1].deltaTime:i[n].ticksToNextEvent=null,i[n].nextEventIndex+=1;for(var o=0;o<i.length;o++)null!=i[o].ticksToNextEvent&&(i[o].ticksToNextEvent-=t);return{ticksToEvent:t,event:a,track:n}}return null}function a(){function e(){u||"meta"!=d.event.type||"setTempo"!=d.event.subtype||(s=6e7/d.event.microsecondsPerBeat);var e=0,n=0;d.ticksToEvent>0&&(e=d.ticksToEvent/c,n=e/(s/60));var r=1e3*n*t||0;f.push([d,r]),d=o()}if(d=o())for(;d;)e(!0)}for(var i=[],s=r?r:120,u=!!r,c=e.header.ticksPerBeat,l=0;l<e.tracks.length;l++)i[l]={nextEventIndex:0,ticksToNextEvent:e.tracks[l].length?e.tracks[l][0].deltaTime:null};var d,f=[];return a(),{getData:function(){return clone(f)}}}var MidiPiano=MidiPiano||{};!function(e,t){"use strict";function n(){MIDI.programChange(4,MIDI.GM.byName.acoustic_grand_piano.number),MIDI.programChange(3,MIDI.GM.byName.acoustic_grand_piano.number),MIDI.programChange(2,MIDI.GM.byName.acoustic_grand_piano.number),MIDI.programChange(1,MIDI.GM.byName.acoustic_grand_piano.number)}function r(e){C=e?e.displayName+"-"+Math.random().toString(36).substr(2,9):"altspaceUser-"+Math.random().toString(36).substr(2,9),P=Please.make_color({golden:!1,saturation:1,value:1})[0],O=new THREE.Color(P)}function o(e){j=1==e.innerDepth?e.pixelsPerMeter/285.714294*3:e.pixelsPerMeter/285.714294*3,q=q*j/3,U=U*j/3,_=_*j/3,L=79*j,G=G*j/3,z=1.5*j}function a(e){var a=[t.getUser(),t.getEnclosure()];Promise.all(a).then(function(t){var a=t.shift();r(a);var i=t.shift();o(i),s(function(){n(),altspace.getThreeJSTrackingSkeleton().then(function(t){T=t,S.add(T),console.log("Connected to Firebase!"),D=e.instance.child("data"),B=e.instance.child("users"),D.child("name").set(N),console.log("Initalizing Piano...."),u()})})})}function i(){altspace.inClient&&t.getSpace().then(function(e){R=e.sid,N=e.name,console.log("Connecting to Firebase....");var n={appId:"Midi Piano",instanceId:R,authorId:"NorybiaK",baseRefUrl:"midi-piano.firebaseio.com"};t.utilities.sync.connect(n).then(function(e){location.search&&a(e)})})}function s(e){MIDI.loadPlugin({soundfontUrl:"assets/soundfont/",targetFormat:"ogg",instruments:"acoustic_grand_piano",onsuccess:e})}function u(){for(var e=0;e<7;++e){var t=12*e;c(t+0,"W","B"),c(t+1,"B","W"),c(t+2,"W","B"),c(t+3,"W","W"),c(t+4,"B","W"),c(t+5,"W","B"),c(t+6,"B","W"),c(t+7,"W","B"),c(t+8,"W","W"),c(t+9,"B","W"),c(t+10,"W","B"),c(t+11,"B","W")}c(84,"W","B"),c(85,"B","W"),c(86,"W","B"),c(87,"W","W"),MIDI.Player.addListener(function(e){var t=(e.channel,e.velocity),n=(e.message,e.note-21);144==e.message?0==t?"B"==A[n]?k[n].material.color=W:k[n].material.color=H:k[n].material.color=F:"B"==A[n]?k[n].material.color=W:k[n].material.color=H,k[n].material.needsUpdate=!0}),UltimateLoader.load("assets/model/piano.obj",function(t){E=t,E.scale.set(j,j,j),X.add(E),X.position.set(b.x,b.y,b.z),X.rotation.x=b.x*(Math.PI/180),X.rotation.y=b.y*(Math.PI/180),X.rotation.z=b.z*(Math.PI/180),S.add(X);var n=d("Play me!",0,125,67,-18,50);E.add(n);var r=d("MIDI Keyboard?",0,118,69,-18,50);E.add(r);var o=d("Visit - norybiak.com/apps/piano -",0,114,70,-18,50);E.add(o);var a=new THREE.MTLLoader.MaterialCreator;a.crossOrigin="anonymous";var i="assets/textures/wood.jpg",s=a.loadTexture(i),u=new THREE.MeshBasicMaterial({color:"#FFFFFF",map:s}),c=new THREE.BoxGeometry(7,5,30),f=new THREE.Mesh(c,u);f.scale.set(1,1,1),f.position.set(-75.9,79.5,83),E.add(f);var h=new THREE.Mesh(c,u);for(h.scale.set(1,1,1),h.position.set(77.3,79.5,83),E.add(h),l(),e=0;e<re.length;e++)re[e].text=d(re[e].title,0,100,80.5,0,50),E.add(re[e].text),re[e].text.visible=!1;animate(),p(),console.log("Piano initalized!")})}function c(e,t,n){if("W"==t){_+="W"==n?q:U,w||(w=new THREE.BoxGeometry(2.68,5.83,17.5),w.name="whiteKeyGeometry",w.translate(0,0,8.75));var r=new THREE.MTLLoader.MaterialCreator;r.crossOrigin="anonymous";var o="assets/textures/keyShadow.png",a=r.loadTexture(o),i=new THREE.MeshBasicMaterial({color:"#FFFFFF",map:a});k[e]=new THREE.Mesh(w,i),k[e].scale.set(j,j,j),k[e].position.set(_,L,G)}else if("B"==t){_+=U,M||(M=new THREE.BoxGeometry(1.52,6.07,12.83),M.name="blackKeyGeometry",M.translate(0,0,6.415));var i=new THREE.MeshBasicMaterial({color:"#000000"});k[e]=new THREE.Mesh(M,i),k[e].scale.set(j,j,j),k[e].position.set(_,L+z,G)}A[e]=t,k[e].addBehavior(altspace.utilities.behaviors.JointCollisionEvents({joints:[["Index","Right",3],["Index","Left",3]],jointCubeSize:.1})),k[e].addEventListener("jointcollisionenter",function(t){Q||(h(e+21,127),B.child(C).child("notes").child(e+21).set([Math.random(),127]),setTimeout(function(){v(e+21,0),B.child(C).child("notes").child(e+21).set([0,127])},300))}),k[e].addEventListener("cursordown",function(){Q||(h(e+21,127),B.child(C).child("notes").child(e+21).set([Math.random(),127]),setTimeout(function(){v(e+21,0),B.child(C).child("notes").child(e+21).set([0,127])},300))}),X.add(k[e])}function l(){var e=new THREE.MTLLoader.MaterialCreator;e.crossOrigin="anonymous";var t="assets/textures/buttonShadow.png",n=e.loadTexture(t),r=new THREE.BoxGeometry(3,3,3);r.name="buttonGeometry";var o=new THREE.Mesh(r,new THREE.MeshBasicMaterial({color:"#00ff00",map:n}));o.scale.set(1,1,1),o.position.set(0,5,0),J.add(o),o.addEventListener("cursordown",function(e){MIDI.Player.playing||(D.update({startTime:Firebase.ServerValue.TIMESTAMP}),D.update({userStarted:C}),D.update({playing:1}))});var a=d("Play",5,-1.5,.5,0,25);a.x=5,o.add(a);var i=new THREE.Mesh(r,new THREE.MeshBasicMaterial({color:"#f0ff00",map:n}));i.scale.set(1,1,1),i.position.set(0,0,0),J.add(i),i.addEventListener("cursorup",function(e){te++,D.update({playing:0,song:te})});var s=d("Next",5,-1.5,.5,0,25);i.add(s);var u=new THREE.Mesh(r,new THREE.MeshBasicMaterial({color:"#FF0000",map:n}));u.scale.set(1,1,1),u.position.set(0,-5,0),J.add(u),u.addEventListener("cursorup",function(e){D.update({playing:0})});var c=d("Stop",5,-1.5,.5,0,25);u.add(c),J.position.set(-66,95,80),E.add(J);var l=new THREE.Mesh(r,new THREE.MeshBasicMaterial({color:"#f0ff00",map:n}));l.scale.set(1,1,1),l.position.set(-70,0,0),K.add(l);var f=d("Mute",0,3,.5,0,25),p=d("Unmute",0,3,.5,0,25);p.visible=!1,l.add(f),l.add(p),l.addEventListener("cursorup",function(e){f.visible=!f.visible,p.visible=!p.visible,Q=!Q,m(Q?0:Z)});var h=new THREE.Group;h.position.set(-55,-1,0),K.add(h);var v=d("Vol",0,-4.5,.5,0,25);h.add(v);for(var g=new THREE.BoxGeometry(.8,1,2),y=0;y<5;y++)V[y]=new THREE.Mesh(g,new THREE.MeshBasicMaterial({color:"#f0ff00",map:n})),V[y].scale.set(2,2*y+2,2),V[y].position.set(-4.2+2*y,-.5+(y+1),-.5),h.add(V[y]),V[y].addEventListener("cursorup",function(e){for(var t=!1,n=0;n<5;n++)e.target==V[n]?(V[n].material.color=$,Z=n+1,m(Z),t=!0):t?V[n].material.color=Y:V[n].material.color=$});K.position.set(120,95,80),K.scale.set(1,1,1),E.add(K)}function d(e,t,n,r,o,a){var i={text:e,fontSize:a},s=g(i);return s.position.set(t,n,r+1),s.rotateX(o*Math.PI/180),s}function f(e,t){e.visible=t}function p(){function e(){t.on("value",function(e){var t=e.val();1==t?(B.child(C).child("control").update({joinTime:Firebase.ServerValue.TIMESTAMP}),D.child("startTime").once("value",function(e){var t=e.val();B.child(C).child("control").child("joinTime").once("value",function(e){var n=e.val(),r=n-t;r>MIDI.Player.endTime?D.update({playing:0}):(MIDI.Player.currentTime=r,MIDI.Player.start())})})):(MIDI.Player.stop(),D.update({startTime:0}))})}D.once("value",function(e){var t=e.exists();t||D.set({playing:0,song:0})}),B.child(C).child("settings").set({color:P}),B.on("child_added",function(e,t){var n=e.key(),r=B.child(n);n!=C&&(console.log("New user joined: "+n),r.child("settings").child("color").once("value",function(e){var t=e.val();t||(t=Please.make_color({golden:!1,saturation:1,value:1})[0]),ee[n]=new THREE.Color(t),console.log("User "+n+"'s color is set to "+e.val())}),r.child("notes").on("child_added",function(e){var t=e.key();e.val();r.child("notes").child(t).on("value",function(e){var r=e.val();if(r){var o=r[0],a=r[1];0==o?v(t,a):h(t,a,n)}})}))}),B.child(C).onDisconnect().remove(),B.on("child_removed",function(e){var t=e.key(),n=B.child(t);n.child("on").off("value"),n.child("off").off("value"),delete ee[t],console.log("User "+e.key()+" has left.")});var t=D.child("playing"),n=D.child("song");D.child("currentTime");n.on("value",function(t){var n=t.val();te=n>re.length-1?0:n,ne?(MIDI.Player.timeWarp=re[te].speed,MIDI.Player.loadFile("assets/songs/"+re[te].file,function(){console.log(re[te].title+"  loaded!"),e(),ne=!1})):(MIDI.Player.timeWarp=re[te].speed,MIDI.Player.loadFile("assets/songs/"+re[te].file,function(){console.log(re[te].title+"  loaded!")})),f(re[n-1].text,!1),f(re[te].text,!0),console.log("current song:"+te)}),console.log("Firebase functions initalized!")}function h(e,t,n){if(n=n||!1,Q||MIDI.noteOn(0,e,t),0==k[e-21].rotation.x)if("B"==A[e-21]){new TWEEN.Tween(k[e-21].rotation).to({x:k[e-21].rotation.x+.02*Math.PI},.1).start()}else{new TWEEN.Tween(k[e-21].rotation).to({x:k[e-21].rotation.x+.04*Math.PI},.1).start()}n?k[e-21].material.color=ee[n]:k[e-21].material.color=O}function v(e,t,n){Q||MIDI.noteOff(0,e,t);new TWEEN.Tween(k[e-21].rotation).to({x:0},.1).start();"B"==A[e-21]?k[e-21].material.color=W:k[e-21].material.color=H}function m(e){var t=25.4*e;MIDI.setVolume(0,t),console.log(e+" "+t)}function g(e){var t=y("n-text");return I(t,"n-text",e),t}function y(e){var t=new THREE.Mesh(ae,ie);return S.add(t),altspace.addNativeComponent(t,e),t}function I(e,t,n){var r=oe["n-text"];for(var o in n)r[o]=n[o];altspace.updateNativeComponent(e,t,r)}var T,w,M,E,b,x,S,D,B,C,P,O,k=[],A=[],N="",R="",F=new THREE.Color(16711680),H=new THREE.Color(16777215),W=new THREE.Color(0),_=-217,L=-270,G=240,j=3,q=8.5,U=4.2,z=3,X=new THREE.Group,V=[],K=new THREE.Group,J=new THREE.Group,Q=!1,Z=5,Y=new THREE.Color(10461087),$=new THREE.Color(15793920),ee={},te=0,ne=!0,re=[{file:"mozart_sonata_2-pianos_375_1_(c)ishenko.mid",title:"Sonata in D major, for two - Mozart",speed:1},{file:"517-Scarlatti.mid",title:"Sonata in D minor, K. 517 - Scarlatti",speed:.5},{file:"HungarianRhapsodyNo10S24410.mid",title:"Hungarian Rhapsody No. 10, S. 244/10",speed:1},{file:"Roslin_Adama.mid",title:"Roslin & Adama - Bear McCreary",speed:1},{file:"ParagonX9_Chaoz_Fantasy.mid",title:"Chaoz Fantasy - ParagonX9",speed:1},{file:"swordland_1.mid",title:"Swordland (SAO) - Yuki Kajiura",speed:1},{file:"9725s_maple_leaf_rag_(nc)smythe.mid",title:"Maple Leaf - Scott Joplin",speed:1},{file:"hes_a_pirate.mid",title:"He's a Pirate - Klaus Badelt",speed:1},{file:"touhou.mid",title:"U.N. Owen Was Her? - ZUN",speed:1},{file:"cruel_angel.mid",title:"Cruel Angel - Neko Oikawa",speed:1},{file:"tchaikovsky_nutcracker_act-1_2_march_(c)yogore.mid",title:"March (Nutcracker) - Tchaikovsky",speed:1},{file:"Hotline_Bling_MIDI_UPDATED_2016.mid",title:"Hotline Bling",speed:1}],oe={"n-text":{text:"",fontSize:10,width:80,height:1,horizontalAlign:"middle",verticalAlign:"middle"}};e.start=function(e,t){return S=e||!1,b=t.position||{x:0,y:0,z:0},x=t.rotation||{x:0,y:0,z:0},S?void i():void console.log("MidiPiano must be passed a scene! Exiting...")},e.update=function(){TWEEN.update()};var ae=new THREE.BoxGeometry(.001,.001,.001),ie=new THREE.MeshBasicMaterial({color:0});ie.visible=!1,window.AFRAME&&AFRAME.registerComponent("midi-piano",{schema:{position:{type:"vec3",default:"0 0 0"},rotation:{type:"vec3",default:"0 0 0"}},init:function(){e.start(this.el.object3D,this.data)},tick:function(){isInitilized&&e.update()}})}(MidiPiano,altspace),function(){function e(e){this.message=e}var t="undefined"!=typeof exports?exports:this,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e.prototype=new Error,e.prototype.name="InvalidCharacterError",t.btoa||(t.btoa=function(t){for(var r,o,a=0,i=n,s="";t.charAt(0|a)||(i="=",a%1);s+=i.charAt(63&r>>8-a%1*8)){if(o=t.charCodeAt(a+=.75),o>255)throw new e("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");r=r<<8|o}return s}),t.atob||(t.atob=function(t){if(t=t.replace(/=+$/,""),t.length%4==1)throw new e("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,o,a=0,i=0,s="";o=t.charAt(i++);~o&&(r=a%4?64*r+o:o,a++%4)?s+=String.fromCharCode(255&r>>(-2*a&6)):0)o=n.indexOf(o);return s})}();var Base64Binary={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",decodeArrayBuffer:function(e){var t=Math.ceil(3*e.length/4),n=new ArrayBuffer(t);return this.decode(e,n),n},decode:function(e,t){var n=this._keyStr.indexOf(e.charAt(e.length-1)),r=this._keyStr.indexOf(e.charAt(e.length-1)),o=Math.ceil(3*e.length/4);64==n&&o--,64==r&&o--;var a,i,s,u,c,l,d,f,p=0,h=0;for(a=t?new Uint8Array(t):new Uint8Array(o),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""),p=0;p<o;p+=3)c=this._keyStr.indexOf(e.charAt(h++)),l=this._keyStr.indexOf(e.charAt(h++)),d=this._keyStr.indexOf(e.charAt(h++)),f=this._keyStr.indexOf(e.charAt(h++)),i=c<<2|l>>4,s=(15&l)<<4|d>>2,u=(3&d)<<6|f,a[p]=i,64!=d&&(a[p+1]=s),64!=f&&(a[p+2]=u);return a}};if("undefined"==typeof MIDI&&(MIDI={}),function(e){var t=e.util||(e.util={});if(t.request=function(t,r,o,a){"use strict";"string"==typeof t&&(t={url:t});var i=t.data,s=t.url,u=t.method||(t.data?"POST":"GET"),c=t.format,l=t.headers,d=t.responseType,f=t.withCredentials||!1,r=r||t.onsuccess,o=o||t.onerror,a=a||t.onprogress;if("undefined"!=typeof n&&e.loc.isLocalUrl(s))return void n.readFile(s,"utf8",function(e,t){e?o&&o(e):r&&r({responseText:t})});var p=new XMLHttpRequest;if(p.open(u,s,!0),l)for(var h in l)p.setRequestHeader(h,l[h]);else i&&p.setRequestHeader("Content-type","application/x-www-form-urlencoded");return"binary"===c&&p.overrideMimeType&&p.overrideMimeType("text/plain; charset=x-user-defined"),d&&(p.responseType=d),f&&(p.withCredentials="true"),o&&"onerror"in p&&(p.onerror=o),a&&p.upload&&"onprogress"in p.upload&&(i?p.upload.onprogress=function(e){a.call(p,e,event.loaded/event.total)}:p.addEventListener("progress",function(e){var t=0;if(e.lengthComputable)t=e.total;else if(p.totalBytes)t=p.totalBytes;else{var n=parseInt(p.getResponseHeader("Content-Length-Raw"));if(!isFinite(n))return;p.totalBytes=t=n}a.call(p,e,e.loaded/t)})),p.onreadystatechange=function(t){if(4===p.readyState)if(200===p.status||304===p.status||308===p.status||0===p.status&&e.client.cordova){if(r){var n;if("xml"===c)n=t.target.responseXML;else if("text"===c)n=t.target.responseText;else if("json"===c)try{n=JSON.parse(t.target.response)}catch(e){o&&o.call(p,t)}r.call(p,t,n)}}else o&&o.call(p,t)},p.send(i),p},"undefined"!=typeof module&&module.exports){var n=require("fs");XMLHttpRequest=require("xmlhttprequest").XMLHttpRequest,module.exports=e.util.request}}(MIDI),"undefined"==typeof dom)var dom={};!function(){"use strict";dom.loadScript=function(){return this.loaded={},this.loading={},this},dom.loadScript.prototype.add=function(t){var n=this;"string"==typeof t&&(t={url:t});var r=t.urls;"undefined"==typeof r&&(r=[{url:t.url,verify:t.verify}]);var o=document.getElementsByTagName("head")[0],a=function(t,r){n.loaded[t.url]||r&&e(r)===!1||(n.loaded[t.url]=!0,n.loading[t.url]&&n.loading[t.url](),delete n.loading[t.url],t.onsuccess&&t.onsuccess(),"undefined"!=typeof f&&f())},i=!1,s=[],u=function(e){if("string"==typeof e&&(e={url:e,verify:t.verify}),/([\w\d.\[\]\'\"])$/.test(e.verify)){var r=e.test=e.verify;if("object"==typeof r)for(var u=0;u<r.length;u++)s.push(r[u]);else s.push(r)}if(!n.loaded[e.url]){var l=document.createElement("script");l.onreadystatechange=function(){"loaded"!==this.readyState&&"complete"!==this.readyState||a(e)},l.onload=function(){a(e)},l.onerror=function(){if(i=!0,delete n.loading[e.url],"object"==typeof e.test)for(var t in e.test)c(e.test[t]);else c(e.test)},l.setAttribute("type","text/javascript"),l.setAttribute("src",e.url),o.appendChild(l),n.loading[e.url]=function(){}}},c=function(e){for(var t=[],n=0;n<s.length;n++)s[n]!==e&&t.push(s[n]);s=t},l=function(n){if(n)a(n,n.test);else for(var o=0;o<r.length;o++)a(r[o],r[o].test);for(var u=!0,o=0;o<s.length;o++)e(s[o])===!1&&(u=!1);!t.strictOrder&&u?i?t.error&&t.error():t.onsuccess&&t.onsuccess():setTimeout(function(){l(n)},10)};if(t.strictOrder){var d=-1,f=function(){if(d++,r[d]){var e=r[d],o=e.url;n.loading[o]?n.loading[o]=function(){e.onsuccess&&e.onsuccess(),f()}:n.loaded[o]?f():(u(e),l(e))}else i?t.error&&t.error():t.onsuccess&&t.onsuccess()};f()}else for(var d=0;d<r.length;d++)u(r[d]),l(r[d])},dom.loadScript=new dom.loadScript;var e=function(e,t){try{e=e.split('"').join("").split("'").join("").split("]").join("").split("[").join(".");for(var n=e.split("."),r=n.length,o=t||window,a=0;a<r;a++){var i=n[a];if(null==o[i])return!1;o=o[i]}return!0}catch(e){return!1}}}(),"undefined"!=typeof module&&module.exports&&(module.exports=dom.loadScript);var clone=function(e){if("object"!=typeof e)return e;if(null==e)return e;var t="number"==typeof e.length?[]:{};for(var n in e)t[n]=clone(e[n]);return t};if("undefined"==typeof MIDI&&(MIDI={}),function(e){"use strict";var t={},n=0;e.audioDetect=function(e){if(navigator.requestMIDIAccess){var r=Function.prototype.toString.call(navigator.requestMIDIAccess).indexOf("[native code]");if(r)t.webmidi=!0;else for(var o=0;navigator.plugins.length>o;o++){var a=navigator.plugins[o];a.name.indexOf("Jazz-Plugin")>=0&&(t.webmidi=!0)}}if("undefined"==typeof Audio)return e({});t.audiotag=!0,(window.AudioContext||window.webkitAudioContext)&&(t.webaudio=!0);var i=new Audio;if("undefined"==typeof i.canPlayType)return e(t);var s=i.canPlayType('audio/ogg; codecs="vorbis"');s="probably"===s||"maybe"===s;var u=i.canPlayType("audio/mpeg");if(u="probably"===u||"maybe"===u,!s&&!u)return void e(t);var c=(new Date).getTime(),l=window.setInterval(function(){var r=(new Date).getTime(),o=r-c>5e3;n&&!o||(window.clearInterval(l),e(t))},1)}}(MIDI),function(e){"use strict";e.GM=function(e){var t=function(e){return e.replace(/[^a-z0-9 ]/gi,"").replace(/[ ]/g,"_").toLowerCase()},n={byName:{},byId:{},byCategory:{}};for(var r in e)for(var o=e[r],a=0,i=o.length;a<i;a++){var s=o[a];if(s){var u=parseInt(s.substr(0,s.indexOf(" ")),10);s=s.replace(u+" ",""),n.byId[--u]=n.byName[t(s)]=n.byCategory[t(r)]={id:t(s),instrument:s,number:u,category:r}}}return n}({Piano:["1 Acoustic Grand Piano","2 Bright Acoustic Piano","3 Electric Grand Piano","4 Honky-tonk Piano","5 Electric Piano 1","6 Electric Piano 2","7 Harpsichord","8 Clavinet"],"Chromatic Percussion":["9 Celesta","10 Glockenspiel","11 Music Box","12 Vibraphone","13 Marimba","14 Xylophone","15 Tubular Bells","16 Dulcimer"],Organ:["17 Drawbar Organ","18 Percussive Organ","19 Rock Organ","20 Church Organ","21 Reed Organ","22 Accordion","23 Harmonica","24 Tango Accordion"],Guitar:["25 Acoustic Guitar (nylon)","26 Acoustic Guitar (steel)","27 Electric Guitar (jazz)","28 Electric Guitar (clean)","29 Electric Guitar (muted)","30 Overdriven Guitar","31 Distortion Guitar","32 Guitar Harmonics"],Bass:["33 Acoustic Bass","34 Electric Bass (finger)","35 Electric Bass (pick)","36 Fretless Bass","37 Slap Bass 1","38 Slap Bass 2","39 Synth Bass 1","40 Synth Bass 2"],Strings:["41 Violin","42 Viola","43 Cello","44 Contrabass","45 Tremolo Strings","46 Pizzicato Strings","47 Orchestral Harp","48 Timpani"],Ensemble:["49 String Ensemble 1","50 String Ensemble 2","51 Synth Strings 1","52 Synth Strings 2","53 Choir Aahs","54 Voice Oohs","55 Synth Choir","56 Orchestra Hit"],Brass:["57 Trumpet","58 Trombone","59 Tuba","60 Muted Trumpet","61 French Horn","62 Brass Section","63 Synth Brass 1","64 Synth Brass 2"],Reed:["65 Soprano Sax","66 Alto Sax","67 Tenor Sax","68 Baritone Sax","69 Oboe","70 English Horn","71 Bassoon","72 Clarinet"],Pipe:["73 Piccolo","74 Flute","75 Recorder","76 Pan Flute","77 Blown Bottle","78 Shakuhachi","79 Whistle","80 Ocarina"],"Synth Lead":["81 Lead 1 (square)","82 Lead 2 (sawtooth)","83 Lead 3 (calliope)","84 Lead 4 (chiff)","85 Lead 5 (charang)","86 Lead 6 (voice)","87 Lead 7 (fifths)","88 Lead 8 (bass + lead)"],"Synth Pad":["89 Pad 1 (new age)","90 Pad 2 (warm)","91 Pad 3 (polysynth)","92 Pad 4 (choir)","93 Pad 5 (bowed)","94 Pad 6 (metallic)","95 Pad 7 (halo)","96 Pad 8 (sweep)"],"Synth Effects":["97 FX 1 (rain)","98 FX 2 (soundtrack)","99 FX 3 (crystal)","100 FX 4 (atmosphere)","101 FX 5 (brightness)","102 FX 6 (goblins)","103 FX 7 (echoes)","104 FX 8 (sci-fi)"],Ethnic:["105 Sitar","106 Banjo","107 Shamisen","108 Koto","109 Kalimba","110 Bagpipe","111 Fiddle","112 Shanai"],Percussive:["113 Tinkle Bell","114 Agogo","115 Steel Drums","116 Woodblock","117 Taiko Drum","118 Melodic Tom","119 Synth Drum"],"Sound effects":["120 Reverse Cymbal","121 Guitar Fret Noise","122 Breath Noise","123 Seashore","124 Bird Tweet","125 Telephone Ring","126 Helicopter","127 Applause","128 Gunshot"]}),e.getInstrument=function(t){var n=e.channels[t];return n&&n.instrument},e.setInstrument=function(t,n,r){var o=e.channels[t];return r?setTimeout(function(){o.instrument=n},r):void(o.instrument=n)},e.getMono=function(t){var n=e.channels[t];return n&&n.mono},e.setMono=function(t,n,r){var o=e.channels[t];return r?setTimeout(function(){o.mono=n},r):void(o.mono=n)},e.getOmni=function(t){var n=e.channels[t];return n&&n.omni},e.setOmni=function(t,n){var r=e.channels[t];return delay?setTimeout(function(){r.omni=n},delay):void(r.omni=n)},e.getSolo=function(t){var n=e.channels[t];return n&&n.solo},e.setSolo=function(t,n){var r=e.channels[t];return delay?setTimeout(function(){r.solo=n},delay):void(r.solo=n)},e.channels=function(){for(var e={},t=0;t<16;t++)e[t]={instrument:t,pitchBend:0,mute:!1,mono:!1,omni:!1,solo:!1};return e}(),e.keyToNote={},e.noteToKey={},function(){for(var t=21,n=108,r=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],o=t;o<=n;o++){var a=(o-12)/12>>0,i=r[o%12]+a;e.keyToNote[i]=o,e.noteToKey[o]=i}}()}(MIDI),"undefined"==typeof MIDI&&(MIDI={}),MIDI.Soundfont=MIDI.Soundfont||{},MIDI.Player=MIDI.Player||{},function(e){"use strict";e.DEBUG=!0,e.USE_XHR=!0,e.soundfontUrl="./soundfont/",e.loadPlugin=function(n){"function"==typeof n&&(n={onsuccess:n}),e.soundfontUrl=n.soundfontUrl||e.soundfontUrl,e.audioDetect(function(r){var o=window.location.hash,a="";if(r[n.api]?a=n.api:r[o.substr(1)]?a=o.substr(1):(window.AudioContext||window.webkitAudioContext)&&(a="webaudio"),console.log(a),t[a]){if(n.targetFormat)var i=n.targetFormat;else var i=r["audio/ogg"]?"ogg":"mp3";e.__api=a,e.__audioFormat=i,e.supports=r,e.loadResource(n)}})},e.loadResource=function(n){var r=n.instruments||n.instrument||"acoustic_grand_piano";"object"!=typeof r&&(r=r||0===r?[r]:[]);for(var o=0;o<r.length;o++){var a=r[o];a===+a&&e.GM.byId[a]&&(r[o]=e.GM.byId[a].id)}n.format=e.__audioFormat,n.instruments=r,t[e.__api](n)};var t={webaudio:function(e){n(e,"WebAudio")}},n=function(t,n){for(var o=t.format,a=t.instruments,i=t.onprogress,s=t.onerror,u=a.length,c=u,l=function(){--c||(i&&i("load",1),e[n].connect(t))},d=0;d<u;d++){var f=a[d];MIDI.Soundfont[f]?l():r(a[d],o,function(e,t){var n=t/u,r=(u-c)/u;i&&i("load",n+r,f)},function(){l()},s)}},r=function(t,n,r,o,a){var i=e.soundfontUrl+t+"-"+n+".js";e.USE_XHR?e.util.request({url:i,format:"text",onerror:a,onprogress:r,onsuccess:function(e,t){var n=document.createElement("script");n.language="javascript",n.type="text/javascript",n.text=t,document.body.appendChild(n),o()}}):dom.loadScript.add({url:i,verify:'MIDI.Soundfont["'+t+'"]',onerror:a,onsuccess:function(){o()}})};e.setDefaultPlugin=function(t){for(var n in t)e[n]=t[n]}}(MIDI),"undefined"==typeof MIDI&&(MIDI={}),"undefined"==typeof MIDI.Player&&(MIDI.Player={}),function(){"use strict";var e=MIDI.Player;e.currentTime=0,e.endTime=0,e.restart=0,e.playing=!1,e.timeWarp=1,e.startDelay=0,e.BPM=120,e.start=e.resume=function(t){e.currentTime<-1&&(e.currentTime=-1),d(e.currentTime,null,t)},e.pause=function(){var t=e.restart;f(),e.restart=t},e.stop=function(){f(),e.restart=0,e.currentTime=0},e.addListener=function(e){i=e},e.removeListener=function(){i=void 0},e.clearAnimation=function(){e.animationFrameId&&cancelAnimationFrame(e.animationFrameId)},e.setAnimation=function(t){var n=0,r=0,o=0;e.clearAnimation();var i=function(){if(e.animationFrameId=requestAnimationFrame(i),0!==e.endTime){e.playing?(n=o===e.currentTime?r-Date.now():0,n=0===e.currentTime?0:e.currentTime-n,o!==e.currentTime&&(r=Date.now(),o=e.currentTime)):n=e.currentTime;var s=e.endTime,u=n/1e3,c=u/60,l=u-60*c,d=60*c+l,f=s/1e3;f-d<-1||t({now:d,end:f,events:a})}};requestAnimationFrame(i)},e.loadMidiFile=function(t,n,r){try{e.replayer=new Replayer(MidiFile(e.currentData),e.timeWarp,null,e.BPM),e.data=e.replayer.getData(),e.endTime=c(),MIDI.loadPlugin({onsuccess:t,onprogress:n,onerror:r})}catch(e){r&&r(e)}},e.loadFile=function(t,n,r,o){if(e.stop(),t.indexOf("base64,")!==-1){var a=window.atob(t.split(",")[1]);e.currentData=a,e.loadMidiFile(n,r,o)}else{var i=new XMLHttpRequest;i.open("GET",t),i.overrideMimeType("text/plain; charset=x-user-defined"),i.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){for(var t=this.responseText||"",a=[],i=t.length,s=String.fromCharCode,u=0;u<i;u++)a[u]=s(255&t.charCodeAt(u));var c=a.join("");e.currentData=c,e.loadMidiFile(n,r,o)}else o&&o("Unable to load MIDI file")},i.send()}},e.getFileInstruments=function(){for(var t={},n={},r=0;r<e.data.length;r++){var o=e.data[r][0].event;if("channel"===o.type){var a=o.channel;switch(o.subtype){case"controller":break;case"programChange":n[a]=o.programNumber;break;case"noteOn":var i=n[a],s=MIDI.GM.byId[isFinite(i)?i:a];t[s.id]=!0}}}var u=[];for(var c in t)u.push(c);return u};var t,n,r=[],o=0,a={},i=void 0,s=function(n,o,s,u,c,l,f){return setTimeout(function(){var u={channel:n,note:o,now:s,end:e.endTime,message:c,velocity:l};128===c?delete a[o]:a[o]=u,i&&i(u),e.currentTime=s,r.shift(),r.length<1e3?d(t,!0):e.currentTime===t&&t<e.endTime&&d(t,!0)},s-u)},u=function(){return"webaudio"===MIDI.api?MIDI.WebAudio.getContext():(e.ctx={currentTime:0},e.ctx)},c=function(){for(var t=e.data,n=t.length,r=.5,o=0;o<n;o++)r+=t[o][1];return r},l=function(){return window.performance&&window.performance.now?window.performance.now():Date.now()},d=function(a,i,d){if(e.replayer){i||("undefined"==typeof a&&(a=e.restart),e.playing&&f(),e.playing=!0,e.data=e.replayer.getData(),e.endTime=c());var p,h=0,v=0,m=e.data,g=u(),y=m.length;t=.5;var I=(r[0]&&r[0].interval||0,a-e.currentTime);if("webaudio"!==MIDI.api){var T=l();n=n||T,g.currentTime=(T-n)/1e3}o=g.currentTime;for(var w=0;w<y&&v<100;w++){var M=m[w];if((t+=M[1])<=a)h=t;else{a=t-h;var E=M[0].event;if("channel"===E.type){var b=E.channel,x=MIDI.channels[b],S=g.currentTime+(a+I+e.startDelay)/1e3,D=t-h+e.startDelay;switch(E.subtype){case"controller":MIDI.setController(b,E.controllerType,E.value,S);break;case"programChange":MIDI.programChange(b,E.programNumber,S);break;case"pitchBend":MIDI.pitchBend(b,E.value,S);break;case"noteOn":if(x.mute)break;p=E.noteNumber-(e.MIDIOffset||0),r.push({event:E,time:D,source:MIDI.noteOn(b,E.noteNumber,E.velocity,S),interval:s(b,p,t+e.startDelay,h-I,144,E.velocity)}),v++;break;case"noteOff":if(x.mute)break;p=E.noteNumber-(e.MIDIOffset||0),r.push({event:E,time:D,source:MIDI.noteOff(b,E.noteNumber,S),interval:s(b,p,t,h-I,128,0)})}}}}d&&d(r)}},f=function(){var t=u();for(e.playing=!1,e.restart+=1e3*(t.currentTime-o);r.length;){var n=r.pop();window.clearInterval(n.interval),n.source&&("number"==typeof n.source?window.clearTimeout(n.source):n.source.disconnect(0))}for(var s in a){var n=a[s];144===a[s].message&&i&&i({channel:n.channel,note:n.note,now:n.now,end:n.end,message:128,velocity:n.velocity})}a={}}}(),function(e){"use strict";!function(){function t(e,t,n){if(o){var a=new Audio;a.src=e,a.controls=!1,a.autoplay=!1,a.preload=!1,a.addEventListener("canplay",function(){t&&t(a)}),a.addEventListener("error",function(e){n&&n(e)}),document.body.appendChild(a)}else if(0===e.indexOf("data:audio")){var i=e.split(",")[1],s=Base64Binary.decodeArrayBuffer(i);r.decodeAudioData(s,t,n);
}else{var u=new XMLHttpRequest;u.open("GET",e,!0),u.responseType="arraybuffer",u.onload=function(){r.decodeAudioData(u.response,t,n)},u.send(),console.log("XMLHTTP Buffer")}}function n(){return new(window.AudioContext||window.webkitAudioContext)}var r,o=!1,a=e.WebAudio={api:"webaudio"},i={},s={},u=127,c={};a.audioBuffers=c,a.send=function(e,t){},a.setController=function(e,t,n,r){},a.setVolume=function(e,t,n){if(n)setTimeout(function(){u=t},1e3*n);else{u=t;var r=u/127;for(var o in a.audioBuffers)a.audioBuffers[o].gain=Math.min(1,Math.max(-1,r))}},a.programChange=function(t,n,r){var o=e.channels[t];o.instrument=n},a.pitchBend=function(t,n,r){var o=e.channels[t];o.pitchBend=n},a.noteOn=function(t,n,a,l){l=l||0;var d=e.channels[t],f=d.instrument,p=f+""+n,h=c[p];if(h){if(l<r.currentTime&&(l+=r.currentTime),o)var v=r.createMediaElementSource(h);else{var v=r.createBufferSource();v.buffer=h}if(s){var m=v;for(var g in s)m.connect(s[g].input),m=s[g]}var y=a/127*(u/127)*2-1;if(v.connect(r.destination),v.playbackRate.value=1,v.gainNode=r.createGain(),v.gainNode.connect(r.destination),v.gainNode.gain.value=Math.min(1,Math.max(-1,y)),v.connect(v.gainNode),o){if(l)return setTimeout(function(){h.currentTime=0,h.play()},1e3*l);h.currentTime=0,h.play()}else v.start(l||0);return i[t+""+n]=v,v}},a.noteOff=function(t,n,a){a=a||0;var s=e.channels[t],u=s.instrument,l=u+""+n,d=c[l];if(d){a<r.currentTime&&(a+=r.currentTime);var f=i[t+""+n];if(f){if(f.gainNode){var p=f.gainNode.gain;p.linearRampToValueAtTime(p.value,a),p.linearRampToValueAtTime(-1,a+.3)}return o?a?setTimeout(function(){d.pause()},1e3*a):d.pause():f.noteOff?f.noteOff(a+.5):f.stop(a+.5),delete i[t+""+n],f}}},a.chordOn=function(e,t,n,r){for(var o,i={},s=0,u=t.length;s<u;s++)i[o=t[s]]=a.noteOn(e,o,n,r);return i},a.chordOff=function(e,t,n){for(var r,o={},i=0,s=t.length;i<s;i++)o[r=t[i]]=a.noteOff(e,r,n);return o},a.stopAllNotes=function(){for(var e in i){var t=0;t<r.currentTime&&(t+=r.currentTime);var n=i[e];n.gain.linearRampToValueAtTime(1,t),n.gain.linearRampToValueAtTime(0,t+.3),n.noteOff?n.noteOff(t+.3):n.stop(t+.3),delete i[e]}},a.setEffects=function(e){if(!r.tunajs)return console.log("Effects module not installed.");for(var t=0;t<e.length;t++){var n=e[t],o=new r.tunajs[n.type](n);o.connect(r.destination),s[n.type]=o}},a.connect=function(t){e.setDefaultPlugin(a),a.setContext(r||n(),t.onsuccess)},a.getContext=function(){return r},a.setContext=function(n,o,a,i){r=n,"undefined"==typeof Tuna||r.tunajs||(r.tunajs=new Tuna(r));var s=[],u=e.keyToNote;for(var l in u)s.push(l);var d=function(e){for(var t in p)if(p[t])return;o&&(o(),o=null)},f=function(n,r,o,a){var i=n[a];i&&(p[r]++,t(i,function(t){t.id=a;var o=e.keyToNote[a];if(c[r+""+o]=t,0===--p[r]){n.isLoaded=!0,d(h)}},function(e){}))},p={};for(var h in e.Soundfont){var v=e.Soundfont[h];if(!v.isLoaded){var m=e.GM.byName[h],g=m.number;p[g]=0;for(var y=0;y<s.length;y++){var l=s[y];f(v,g,y,l)}}}setTimeout(d,1)}}()}(MIDI),function(e){"use strict";var t=null,n=null,r=e.WebMIDI={api:"webmidi"};r.send=function(e,t){n.send(e,1e3*t)},r.setController=function(e,t,r,o){n.send([e,t,r],1e3*o)},r.setVolume=function(e,t,r){n.send([176+e,7,t],1e3*r)},r.programChange=function(e,t,r){n.send([192+e,t],1e3*r)},r.pitchBend=function(e,t,r){n.send([224+e,t],1e3*r)},r.noteOn=function(e,t,r,o){n.send([144+e,t,r],1e3*o)},r.noteOff=function(e,t,r){n.send([128+e,t,0],1e3*r)},r.chordOn=function(e,t,r,o){for(var a=0;a<t.length;a++){var i=t[a];n.send([144+e,i,r],1e3*o)}},r.chordOff=function(e,t,r){for(var o=0;o<t.length;o++){var a=t[o];n.send([128+e,a,0],1e3*r)}},r.stopAllNotes=function(){n.cancel();for(var e=0;e<16;e++)n.send([176+e,123,0])},r.connect=function(o){e.setDefaultPlugin(r);var a=function(t){if(window.AudioContext)o.api="webaudio";else{if(!window.Audio)return;o.api="audiotag"}e.loadPlugin(o)};navigator.requestMIDIAccess().then(function(e){t=e;var r=t.outputs;n="function"==typeof r?r()[0]:r[0],void 0===n?a():o.onsuccess&&o.onsuccess()},a)}}(MIDI),"undefined"==typeof MIDI&&(MIDI={}),function(e){var t=e.util||(e.util={});if(t.request=function(t,r,o,a){"use strict";"string"==typeof t&&(t={url:t});var i=t.data,s=t.url,u=t.method||(t.data?"POST":"GET"),c=t.format,l=t.headers,d=t.responseType,f=t.withCredentials||!1,r=r||t.onsuccess,o=o||t.onerror,a=a||t.onprogress;if("undefined"!=typeof n&&e.loc.isLocalUrl(s))return void n.readFile(s,"utf8",function(e,t){e?o&&o(e):r&&r({responseText:t})});var p=new XMLHttpRequest;if(p.open(u,s,!0),l)for(var h in l)p.setRequestHeader(h,l[h]);else i&&p.setRequestHeader("Content-type","application/x-www-form-urlencoded");return"binary"===c&&p.overrideMimeType&&p.overrideMimeType("text/plain; charset=x-user-defined"),d&&(p.responseType=d),f&&(p.withCredentials="true"),o&&"onerror"in p&&(p.onerror=o),a&&p.upload&&"onprogress"in p.upload&&(i?p.upload.onprogress=function(e){a.call(p,e,event.loaded/event.total)}:p.addEventListener("progress",function(e){var t=0;if(e.lengthComputable)t=e.total;else if(p.totalBytes)t=p.totalBytes;else{var n=parseInt(p.getResponseHeader("Content-Length-Raw"));if(!isFinite(n))return;p.totalBytes=t=n}a.call(p,e,e.loaded/t)})),p.onreadystatechange=function(e){if(4===p.readyState)if(200===p.status||304===p.status||308===p.status){if(r){var t;if("xml"===c)t=e.target.responseXML;else if("text"===c)t=e.target.responseText;else if("json"===c)try{t=JSON.parse(e.target.response)}catch(t){o&&o.call(p,e)}r.call(p,e,t)}}else o&&o.call(p,e)},p.send(i),p},"undefined"!=typeof module&&module.exports){var n=require("fs");XMLHttpRequest=require("xmlhttprequest").XMLHttpRequest,module.exports=e.util.request}}(MIDI),"undefined"==typeof dom)var dom={};!function(){"use strict";dom.loadScript=function(){return this.loaded={},this.loading={},this},dom.loadScript.prototype.add=function(t){var n=this;"string"==typeof t&&(t={url:t});var r=t.urls;"undefined"==typeof r&&(r=[{url:t.url,verify:t.verify}]);var o=document.getElementsByTagName("head")[0],a=function(t,r){n.loaded[t.url]||r&&e(r)===!1||(n.loaded[t.url]=!0,n.loading[t.url]&&n.loading[t.url](),delete n.loading[t.url],t.onsuccess&&t.onsuccess(),"undefined"!=typeof f&&f())},i=!1,s=[],u=function(e){if("string"==typeof e&&(e={url:e,verify:t.verify}),/([\w\d.\[\]\'\"])$/.test(e.verify)){var r=e.test=e.verify;if("object"==typeof r)for(var u=0;u<r.length;u++)s.push(r[u]);else s.push(r)}if(!n.loaded[e.url]){var l=document.createElement("script");l.onreadystatechange=function(){"loaded"!==this.readyState&&"complete"!==this.readyState||a(e)},l.onload=function(){a(e)},l.onerror=function(){if(i=!0,delete n.loading[e.url],"object"==typeof e.test)for(var t in e.test)c(e.test[t]);else c(e.test)},l.setAttribute("type","text/javascript"),l.setAttribute("src",e.url),o.appendChild(l),n.loading[e.url]=function(){}}},c=function(e){for(var t=[],n=0;n<s.length;n++)s[n]!==e&&t.push(s[n]);s=t},l=function(n){if(n)a(n,n.test);else for(var o=0;o<r.length;o++)a(r[o],r[o].test);for(var u=!0,o=0;o<s.length;o++)e(s[o])===!1&&(u=!1);!t.strictOrder&&u?i?t.error&&t.error():t.onsuccess&&t.onsuccess():setTimeout(function(){l(n)},10)};if(t.strictOrder){var d=-1,f=function(){if(d++,r[d]){var e=r[d],o=e.url;n.loading[o]?n.loading[o]=function(){e.onsuccess&&e.onsuccess(),f()}:n.loaded[o]?f():(u(e),l(e))}else i?t.error&&t.error():t.onsuccess&&t.onsuccess()};f()}else for(var d=0;d<r.length;d++)u(r[d]),l(r[d])},dom.loadScript=new dom.loadScript;var e=function(e,t){try{e=e.split('"').join("").split("'").join("").split("]").join("").split("[").join(".");for(var n=e.split("."),r=n.length,o=t||window,a=0;a<r;a++){var i=n[a];if(null==o[i])return!1;o=o[i]}return!0}catch(e){return!1}}}(),"undefined"!=typeof module&&module.exports&&(module.exports=dom.loadScript),function(){if("performance"in window==!1&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in window.performance==!1){var e=window.performance.timing&&window.performance.timing.navigationStart?window.performance.timing.navigationStart:Date.now();window.performance.now=function(){return Date.now()-e}}}();var TWEEN=TWEEN||function(){var e=[];return{getAll:function(){return e},removeAll:function(){e=[]},add:function(t){e.push(t)},remove:function(t){var n=e.indexOf(t);n!==-1&&e.splice(n,1)},update:function(t){if(0===e.length)return!1;var n=0;for(t=void 0!==t?t:window.performance.now();n<e.length;)e[n].update(t)?n++:e.splice(n,1);return!0}}}();TWEEN.Tween=function(e){var t=e,n={},r={},o={},a=1e3,i=0,s=!1,u=!1,c=!1,l=0,d=null,f=TWEEN.Easing.Linear.None,p=TWEEN.Interpolation.Linear,h=[],v=null,m=!1,g=null,y=null,I=null;for(var T in e)n[T]=parseFloat(e[T],10);this.to=function(e,t){return void 0!==t&&(a=t),r=e,this},this.start=function(e){TWEEN.add(this),u=!0,m=!1,d=void 0!==e?e:window.performance.now(),d+=l;for(var a in r){if(r[a]instanceof Array){if(0===r[a].length)continue;r[a]=[t[a]].concat(r[a])}void 0!==n[a]&&(n[a]=t[a],n[a]instanceof Array==!1&&(n[a]*=1),o[a]=n[a]||0)}return this},this.stop=function(){return u?(TWEEN.remove(this),u=!1,null!==I&&I.call(t),this.stopChainedTweens(),this):this},this.stopChainedTweens=function(){for(var e=0,t=h.length;e<t;e++)h[e].stop()},this.delay=function(e){return l=e,this},this.repeat=function(e){return i=e,this},this.yoyo=function(e){return s=e,this},this.easing=function(e){return f=e,this},this.interpolation=function(e){return p=e,this},this.chain=function(){return h=arguments,this},this.onStart=function(e){return v=e,this},this.onUpdate=function(e){return g=e,this},this.onComplete=function(e){return y=e,this},this.onStop=function(e){return I=e,this},this.update=function(e){var u,I,T;if(e<d)return!0;m===!1&&(null!==v&&v.call(t),m=!0),I=(e-d)/a,I=I>1?1:I,T=f(I);for(u in r)if(void 0!==n[u]){var w=n[u]||0,M=r[u];M instanceof Array?t[u]=p(M,T):("string"==typeof M&&(M=M.startsWith("+")||M.startsWith("-")?w+parseFloat(M,10):parseFloat(M,10)),"number"==typeof M&&(t[u]=w+(M-w)*T))}if(null!==g&&g.call(t,T),1===I){if(i>0){isFinite(i)&&i--;for(u in o){if("string"==typeof r[u]&&(o[u]=o[u]+parseFloat(r[u],10)),s){var E=o[u];o[u]=r[u],r[u]=E}n[u]=o[u]}return s&&(c=!c),d=e+l,!0}null!==y&&y.call(t);for(var b=0,x=h.length;b<x;b++)h[b].start(d+a);return!1}return!0}},TWEEN.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){var t,n=.1,r=.4;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=r/4):t=r*Math.asin(1/n)/(2*Math.PI),-(n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/r)))},Out:function(e){var t,n=.1,r=.4;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=r/4):t=r*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*e)*Math.sin((e-t)*(2*Math.PI)/r)+1)},InOut:function(e){var t,n=.1,r=.4;return 0===e?0:1===e?1:(!n||n<1?(n=1,t=r/4):t=r*Math.asin(1/n)/(2*Math.PI),(e*=2)<1?-.5*(n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/r)):n*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/r)*.5+1)}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?.5*(e*e*((t+1)*e-t)):.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-TWEEN.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*TWEEN.Easing.Bounce.In(2*e):.5*TWEEN.Easing.Bounce.Out(2*e-1)+.5}}},TWEEN.Interpolation={Linear:function(e,t){var n=e.length-1,r=n*t,o=Math.floor(r),a=TWEEN.Interpolation.Utils.Linear;return t<0?a(e[0],e[1],r):t>1?a(e[n],e[n-1],n-r):a(e[o],e[o+1>n?n:o+1],r-o)},Bezier:function(e,t){for(var n=0,r=e.length-1,o=Math.pow,a=TWEEN.Interpolation.Utils.Bernstein,i=0;i<=r;i++)n+=o(1-t,r-i)*o(t,i)*e[i]*a(r,i);return n},CatmullRom:function(e,t){var n=e.length-1,r=n*t,o=Math.floor(r),a=TWEEN.Interpolation.Utils.CatmullRom;return e[0]===e[n]?(t<0&&(o=Math.floor(r=n*(1+t))),a(e[(o-1+n)%n],e[o],e[(o+1)%n],e[(o+2)%n],r-o)):t<0?e[0]-(a(e[0],e[0],e[1],e[1],-r)-e[0]):t>1?e[n]-(a(e[n],e[n],e[n-1],e[n-1],r-n)-e[n]):a(e[o?o-1:0],e[o],e[n<o+1?n:o+1],e[n<o+2?n:o+2],r-o)},Utils:{Linear:function(e,t,n){return(t-e)*n+e},Bernstein:function(e,t){var n=TWEEN.Interpolation.Utils.Factorial;return n(e)/n(t)/n(e-t)},Factorial:function(){var e=[1];return function(t){var n=1;if(e[t])return e[t];for(var r=t;r>1;r--)n*=r;return e[t]=n,n}}(),CatmullRom:function(e,t,n,r,o){var a=.5*(n-e),i=.5*(r-t),s=o*o,u=o*s;return(2*t-2*n+a+i)*u+(-3*t+3*n-2*a-i)*s+a*o+t}}},function(e){"function"==typeof define&&define.amd?define([],function(){return TWEEN}):"undefined"!=typeof module&&"object"==typeof exports?module.exports=TWEEN:void 0!==e&&(e.TWEEN=TWEEN)}(this);